;
; TypeCController.inf
;
[Version]
Signature   = "$WINDOWS NT$"
Class       = USB
ClassGUID   = {36FC9E60-C465-11CF-8056-444553540000}
Provider    = %VendorName%
DriverVer   = 03/03/2021,2.00.00.01
PnpLockdown = 1

CatalogFile.NTARM   = typeccontroller.arm.cat
CatalogFile.NTARM64 = typeccontroller.arm64.cat

[DestinationDirs]
Drivers_Dir       = 13
tycDriverCopy     = 13
DreamLifter.Files = 10,SysArm32

[SourceDisksNames]
1 = %MediaDescription%,,,""

[Manufacturer]
%ManufacturerName% = Standard, NTARM, NTARM64

[SourceDisksFiles.ARM]
tyc.dll           = 1,arm,
WppRecorderUM.dll = 1,arm,

[SourceDisksFiles.ARM64]
tyc.dll           = 1,arm64,
WppRecorderUM.dll = 1,arm64,


[Standard.NTARM]
%DevDesc%=tyc_Inst, umdf2\tyc
%DevDesc%=tyc_Inst, ACPI\LUMI0002

[Standard.NTARM64]
%DevDesc%=tyc_64_Inst, umdf2\tyc
%DevDesc%=tyc_64_Inst, ACPI\LUMI0002

;---------------- copy files

[tyc_Inst.nt]
CopyFiles = tycDriverCopy
AddReg    = WdfExt_AddReg

[tyc_64_Inst.nt]
CopyFiles = tycDriverCopy
AddReg    = WdfExt_AddReg

[tycDriverCopy]
tyc.dll

[tyc_Inst.NT.HW]
AddReg = tyc_Inst_SecurityAddReg

[tyc_64_Inst.NT.HW]
AddReg = tyc_Inst_SecurityAddReg

;-------------- Service installation
[tyc_Inst.NT.Services]
AddService = WUDFRd, 0x000001fa, WUDFRD_ServiceInstall

[tyc_64_Inst.NT.Services]
AddService = WUDFRd, 0x000001fa, WUDFRD_ServiceInstall

[WUDFRD_ServiceInstall]
DisplayName   = %WudfRdDisplayName%
ServiceType   = 1
StartType     = 3
ErrorControl  = 1
ServiceBinary = %12%\WUDFRd.sys

;-------------- WDF specific section

[tyc_Inst.NT.Wdf]
UmdfService                 = tyc, tyc_Install
UmdfServiceOrder            = tyc
UmdfDirectHardwareAccess    = AllowDirectHardwareAccess
UmdfFileObjectPolicy        = AllowNullAndUnknownFileObjects
UmdfHostProcessSharing      = ProcessSharingDisabled
UmdfImpersonationLevel      = Impersonation
UmdfKernelModeClientPolicy  = AllowKernelModeClients

[tyc_64_Inst.NT.Wdf]
UmdfService                 = tyc, tyc_64_Install
UmdfServiceOrder            = tyc
UmdfDirectHardwareAccess    = AllowDirectHardwareAccess
UmdfFileObjectPolicy        = AllowNullAndUnknownFileObjects
UmdfHostProcessSharing      = ProcessSharingDisabled
UmdfImpersonationLevel      = Impersonation
UmdfKernelModeClientPolicy  = AllowKernelModeClients

[tyc_Install]
UmdfLibraryVersion       = 2.15.0
ServiceBinary            = %13%\arm\tyc.dll
UmdfExtensions           = UcmCx0102

[tyc_64_Install]
UmdfLibraryVersion       = 2.15.0
ServiceBinary            = %13%\arm64\tyc.dll
UmdfExtensions           = UcmCx0102

[WdfExt_AddReg]
HKLM, "SOFTWARE\Microsoft\Windows NT\CurrentVersion\WUDF\Services\tyc\Parameters", "EnableDisplay", 0x10001, 1

[tyc_Inst_SecurityAddReg]
HKR,,Security,,"D:P(A;;GA;;;BA)(A;;GA;;;SY)(A;;GA;;;S-1-5-84-0-0-0-0-0)"    ; Allow all UMDF drivers to access this driver

[Strings]
SPSVCINST_ASSOCSERVICE   = 0x00000002
VendorName               = "MMO and LumiaWoA authors"
ManufacturerName         = "Microsoft Mobile Oy"
MediaDescription         = "Microsoft Mobile USB-C Power Delivery Controller Installation Disk"
DevDesc                  = "Microsoft Mobile USB-C Power Delivery Controller"
WudfRdDisplayName        = "Windows Driver Foundation - User-mode Driver Framework Reflector"

SERVICE_KERNEL_DRIVER    = 1
SERVICE_DEMAND_START     = 3
SERVICE_ERROR_NORMAL     = 1
